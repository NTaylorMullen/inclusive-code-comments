/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
{Tracker.trackPageView();const e=StorageController.create(),n=new URL(location.href),t=document.getElementById("feedback-form"),a=document.getElementById("headline"),o=document.getElementById("feedback-form-direct-email"),r=document.getElementById("sender"),s=document.getElementById("text"),g=document.getElementById("success-message"),c=document.getElementById("screenshot-label"),i=document.getElementById("screenshot");translateSection(document.documentElement),n.searchParams.get("title")&&(a.textContent=n.searchParams.get("title")),"1"===n.searchParams.get("screenshot")&&(c.style.display="block",i.checked=!0,o.style.display="none");const l=n.searchParams.get("html"),d=n.searchParams.get("url")||"",u=getDomain(d),m=EnvironmentAdapter.getVersion(),$=`Feedback LanguageTool on ${u} (v${m}, lang: ${navigator.language}, browser: ${BrowserDetector.getBrowserName()})`,y=`<a href="mailto:feedback@languagetool.org?subject=${encodeURIComponent($)}">feedback@languagetool.org</a>`;o.innerHTML=i18nManager.getMessage("feedbackDirectMail",[y]),e.onReady(()=>{const{username:n}=e.getSettings();n&&(r.value=n,s.focus())}),t.addEventListener("submit",n=>{n.preventDefault();const a=r.value;Tracker.trackEvent("Action","send_feedback",a),e.onReady(()=>{const{firstVisit:n,ratingValue:o,sessionCount:c}=e.getStatistics(),{hasPaidSubscription:u,lastChangelog2021Seen:$}=e.getUIState(),{geoIpLanguages:y,knownEmail:k,username:h,geoIpCountry:v,ignoredRules:f,hasSynonymsEnabled:E,apiServerUrl:b}=e.getSettings(),S=f.filter(e=>!StorageControllerClass.getDefaultSettings().ignoredRules.find(n=>n.id===e.id));let I=`From: ${r.value}\n`;I+=`Paying: ${u}\n`,I+=`Account: ${h||"none"}\n`,I+=`Other known email: ${k||h}\n`,I+=`Addon Version: ${m}\n`,I+=`Accept-Languages: ${navigator.languages.join(", ")}\n`,I+=`UI-Language: ${browser.i18n.getUILanguage()}\n`,I+=`GeoIP-Languages: ${y.join(", ")}\n`,I+=`Country: ${v}\n`,I+=`Full URL: ${d}\n`,I+=`HTML: ${l||""}\n`,I+=`Matomo: ${e.getUniqueId()}\n`,I+=`User Agent: ${navigator.userAgent}\n`,I+=`CPU Cores: ${navigator.hardwareConcurrency}\n`,I+=`User since: ${new Date(1e3*(n||0)).toUTCString()}\n`,I+=`Rating: ${o}\n`,I+=`Synonyms: ${E}\n`,I+=`Sessions: ${c}\n`,I+=`API: ${e.getCustomServerUrl()||b}\n`,I+=`DNT: ${navigator.doNotTrack}\n`,I+=`Downlink: ${navigator.connection&&navigator.connection.downlink}\n`,I+=`Connection Type: ${navigator.connection&&navigator.connection.effectiveType}\n`,I+=`Ignored Rules: ${S.map(e=>e.id).join(",")}\n`,I+=`Last Changelog: ${$}\n`;const C=`${s.value}\n\n\n${I}`;e.updateSettings({knownEmail:a});const p={command:"SEND_FEEDBACK",sender:r.value,text:C,includeScreenshot:i.checked};browser.runtime.sendMessage(p).then(()=>{t.style.display="none",g.style.display="block"}).catch(()=>{Tracker.trackError("message","error_send_feedback"),alert(i18nManager.getMessage("feedbackError"))})})})}