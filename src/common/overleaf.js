/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class Overleaf{static _checkForAvailableInputAreas(){const t=[];t.push(...OverleafSourceEditor.getInputAreas()),t.push(...OverleafRichTextEditor.getInputAreas());for(const e of t)this._onInputAreaAvailableCallbacks.forEach(t=>t(e))}static _getSubstring(t,e=0,r=t.length){let i="";for(let n=e;n<r;n++)i+=t[n];return i}static init(){this._storageController=StorageController.create(),this._interval=window.setInterval(()=>{this._checkForAvailableInputAreas()},750)}static initPage(t){let e=null;e=window.setTimeout(()=>{if(!this._storageController||!this._storageController.isReady())return;const{hasSeenNewOverleafTeaser:t}=this._storageController.getUIState();t||this._showTeaser()},800)}static _showTeaser(){const t=Array.from(document.querySelectorAll(`.${this.TOOLBAR_CLASS_NAME}`));if(!t.length)return;const e=t.find(t=>{const e=t.getBoundingClientRect();return e.top>=0&&e.top<window.innerHeight&&e.width>0});if(!e)return;const r=new Hint("","overleaf",i18nManager.getMessage("overleafNewTeaserHeadline"),i18nManager.getMessage("overleafNewTeaserText"),"top-right",e),i=()=>{r.getElement().remove(),e&&e.classList.remove("lt-toolbar--hint-opened"),this._storageController&&this._storageController.updateUIState({hasSeenNewOverleafTeaser:!0})};r.getClose().addEventListener("click",t=>{t.stopImmediatePropagation(),t.preventDefault(),i()},!0),e.classList.add("lt-toolbar--hint-opened"),e.addEventListener("mouseup",t=>{t.target instanceof HTMLElement&&r.getElement().contains(t.target)||i()},{capture:!0,once:!0}),this._onInput(()=>i(),!0)}static _onInput(t,e=!1){const r=window;r&&r.document&&r.document.addEventListener("keydown",e=>{["Control","Shift","Meta","Alt"].includes(e.key)||t()},{capture:!0,once:e})}static destroy(){OverleafSourceEditor.enableBuiltInValidator(),OverleafRichTextEditor.enableBuiltInValidator(),null!==this._interval&&(window.clearInterval(this._interval),this._interval=null),this._onInputAreaAvailableCallbacks=[]}static onInputAreaAvailable(t){this._onInputAreaAvailableCallbacks.push(e=>t(e,!1))}static isEditor(t){return OverleafSourceEditor.isEditor(t)||OverleafRichTextEditor.isEditor(t)}static disableBuiltInValidator(){OverleafSourceEditor.disableBuiltInValidator(),OverleafRichTextEditor.disableBuiltInValidator()}static createMutationObserver(t,e){return OverleafSourceEditor.isEditor(t)?OverleafSourceEditor.createMutationObserver(e):OverleafRichTextEditor.isEditor(t)?OverleafRichTextEditor.createMutationObserver(e):new MutationObserver(e)}static isElementIgnored(t,e){return OverleafSourceEditor.isEditor(t)?OverleafSourceEditor.isElementIgnored(e):!!OverleafRichTextEditor.isEditor(t)&&OverleafRichTextEditor.isElementIgnored(e)}static isBlock(t,e,r){return OverleafSourceEditor.isEditor(t)?OverleafSourceEditor.isBlock(e,r):!!OverleafRichTextEditor.isEditor(t)&&OverleafRichTextEditor.isBlock(e,r)}static isBlockElementRelevant(t,e){return OverleafSourceEditor.isEditor(t)?OverleafSourceEditor.isBlockElementRelevant(e):!!OverleafRichTextEditor.isEditor(t)&&OverleafRichTextEditor.isBlockElementRelevant(e)}static isMutationIgnored(t,e){return OverleafSourceEditor.isEditor(t)?OverleafSourceEditor.isMutationIgnored(e):!!OverleafRichTextEditor.isEditor(t)&&OverleafRichTextEditor.isMutationIgnored(e)}static getFullTextInfo(t,e){return OverleafSourceEditor.isEditor(t)?OverleafSourceEditor.getFullTextInfo(t,e):OverleafRichTextEditor.isEditor(t)?OverleafRichTextEditor.getFullTextInfo(t,e):{text:e,offset:0}}static getSelectedText(){return OverleafSourceEditor.getSelectedText()||OverleafRichTextEditor.getSelectedText()}static getSelection(){return OverleafSourceEditor.getSelection()||OverleafRichTextEditor.getSelection()}static addScrollEventListener(t,e){OverleafSourceEditor.isEditor(t)?OverleafSourceEditor.addScrollEventListener(t,e):OverleafRichTextEditor.isEditor(t)&&OverleafRichTextEditor.addScrollEventListener(t,e)}static removeScrollEventListener(t,e){OverleafSourceEditor.isEditor(t)?OverleafSourceEditor.removeScrollEventListener(t,e):OverleafRichTextEditor.isEditor(t)&&OverleafRichTextEditor.removeScrollEventListener(t,e)}static getScrollableElementSize(t,e){return OverleafSourceEditor.isEditor(t)?OverleafSourceEditor.getScrollableElementSize(t,e):OverleafRichTextEditor.isEditor(t)?OverleafRichTextEditor.getScrollableElementSize(t,e):{width:0,height:0}}static getScrollPosition(t,e,r,i){return OverleafSourceEditor.isEditor(t)?OverleafSourceEditor.getScrollPosition(t,e,r,i):OverleafRichTextEditor.isEditor(t)?OverleafRichTextEditor.getScrollPosition(t,e,r,i):{top:0,left:0}}static getScrollingThrottleLimit(t){return OverleafSourceEditor.isEditor(t)?OverleafSourceEditor.getScrollingThrottleLimit():OverleafRichTextEditor.isEditor(t)?OverleafRichTextEditor.getScrollingThrottleLimit():void 0}static getToolbarPosition(t,e,r){return OverleafSourceEditor.isEditor(t)?OverleafSourceEditor.getToolbarPosition(t,e,r):OverleafRichTextEditor.isEditor(t)?OverleafRichTextEditor.getToolbarPosition(t,e,r):r}static getMaxTextLength(t,e){return Number.MAX_SAFE_INTEGER}static getReplacedParts(t){const e=new Array(t.length).fill(!1),r=new Array(t.length),i=new Array(t.length).fill(0),n=new StringMap(t),o=LatexParser.getCommentTokens(t);for(const t of o)e.fill(!0,t.start,t.end),n.fill(" ",t.start,t.end);o.length&&(t=n.toString());const s=matchAll(t,/\n+/g);for(const t of s){const e=t[0].length;e<4?(r[t.index]=" ",n.fill(" ",t.index,t.index+e)):(n.fill("\n",t.index,t.index+2),n.fill(" ",t.index+2,t.index+e))}s.length&&(t=n.toString());const a=matchAll(t,/\t+/g);for(const t of a){const e=t[0].length;r.fill(" ",t.index,t.index+e),n.fill(" ",t.index,t.index+e)}a.length&&(t=n.toString());const l=LatexParser.getSymbolTokens(t);for(const t of l)if(e.fill(!0,t.start,t.end),this.REPLACABLE_SYMBOLS.has(t.symbolName)){const i=this.REPLACABLE_SYMBOLS.get(t.symbolName);e.fill(!1,t.start,t.start+i.length);for(let e=0;e<i.length;e++)r[t.start+e]=i[e];n.set(i,t.start),n.fill(" ",t.start+i.length,t.end)}l.length&&(t=n.toString());const c=LatexParser.getSwitchTokens(t);for(const t of c)e.fill(!0,t.start,t.textStart),e[t.textEnd]=!0,n.fill(" ",t.start,t.textStart),n.fill(" ",t.textEnd,t.end);c.length&&(t=n.toString());const d=LatexParser.getMathTokens(t);for(const t of d)e.fill(!0,t.start,t.end),n.fill(" ",t.start,t.end);d.length&&(t=n.toString());const u=LatexParser.getCommandTokens(t).reverse();for(const t of u){let o=0===t.arguments.length&&0===t.optionalArguments.length;if(this.COMMANDS_WITH_VALUABLE_ARGUMENT.has(t.commandName)){const r=this.COMMANDS_WITH_VALUABLE_ARGUMENT.get(t.commandName);let i=t.arguments.length>0?t.arguments[0].start:t.end;e.fill(!0,t.start,i);let o=" ".repeat(i-t.start);for(let s=0;s<t.arguments.length;s++){const a=t.arguments[s];e.fill(!0,i,a.start),o+=" ".repeat(a.start-i),r[s]?o+=n.substring(a.start,a.end):(e.fill(!0,a.start,a.end),o+=" ".repeat(a.end-a.start)),i=a.end}e.fill(!0,i,t.end),o+=" ".repeat(t.end-i),n.set(o,t.start)}else if(this.REPLACABLE_COMMANDS.has(t.commandName)){let s="",a=0;const l=this.REPLACABLE_COMMANDS.get(t.commandName);"string"==typeof l?s=l:({replacingText:s,offsetShift:a}=l(t,n)),e.fill(!1,t.start,t.start+s.length),e.fill(!0,t.start+s.length,t.end);for(let e=0;e<s.length;e++)r[t.start+e]=s[e];i.fill(a,t.start,t.start+s.length),o=!1,n.set(s,t.start),n.fill(" ",t.start+s.length,t.end)}else e.fill(!0,t.start,t.end),n.fill(" ",t.start,t.end);if(o)for(let r=t.end;r<n.length&&" "===n.charAt(r);r++)e[r]=!0}u.length&&(t=n.toString());const E=matchAll(t,/ +/g);for(const i of E){const n=i.index,o=i.index+i[0].length,s=0===n||"\n"===t[n-1],a=o===t.length||"\n"===t[o],l=e.indexOf(!1,n);s||a||-1===l?(e.fill(!0,n,o),r.fill(void 0,n,o)):(e.fill(!0,n,l),e.fill(!0,l+1,o),r.fill(void 0,n,l),r.fill(void 0,l+1,o))}const h=[];let g=0;for(;g<e.length;)if(e[g]){let t=g;for(;t<n.length&&e[t];)t++;h.push({offset:g,length:t-g}),g=t}else g++;for(g=0;g<r.length;)if(void 0!==r[g]){const t=i[g];let e=g;for(;e<r.length&&void 0!==r[e]&&i[e]===t;)e++;const n=Overleaf._getSubstring(r,g,e);h.push({offset:g,length:e-g,replacingText:n,offsetShift:t}),g=e}else g++;return h}static shouldUsePartialValidationCaching(t){return OverleafSourceEditor.isEditor(t.inputArea)?OverleafSourceEditor.shouldUsePartialValidationCaching(t):!OverleafRichTextEditor.isEditor(t.inputArea)||OverleafRichTextEditor.shouldUsePartialValidationCaching(t)}static getValidationOptions(t,e){return OverleafSourceEditor.isEditor(t.inputArea)?OverleafSourceEditor.getValidationOptions(t,e):OverleafRichTextEditor.isEditor(t.inputArea)?OverleafRichTextEditor.getValidationOptions(t,e):{useFullValidation:!0}}static filterErrors(t,e){const r=[];for(const i of e){this.DISABLED_RULES.some(t=>i.rule.id.endsWith(t))||(!!binarySearch(t.ignoredParts,t=>compareSegments(i,t))||r.push(i))}return r}static applyFix(t){return OverleafSourceEditor.isEditor(t.editor.inputArea)?OverleafSourceEditor.applyFix(t):OverleafRichTextEditor.isEditor(t.editor.inputArea)?OverleafRichTextEditor.applyFix(t):Promise.reject()}static getDocId(t){const e=t.match(/\/project\/([a-z0-9]+)/);if(e)return e[1]}}Overleaf.TOOLBAR_CLASS_NAME="lt-overleaf-toolbar",Overleaf._storageController=null,Overleaf.REPLACABLE_SYMBOLS=new Map([["~"," "]]),Overleaf.COMMANDS_WITH_VALUABLE_ARGUMENT=new Map([["\\textrm",[!0]],["\\textsf",[!0]],["\\textmd",[!0]],["\\textbf",[!0]],["\\textup",[!0]],["\\textit",[!0]],["\\textsl",[!0]],["\\textsc",[!0]],["\\emph",[!0]],["\\textnormal",[!0]],["\\underline",[!0]],["\\hyperref",[!1,!0]],["\\href",[!1,!0]],["\\hypertarget",[!1,!0]],["\\hyperlink",[!1,!0]],["\\caption",[!0]],["\\item",[!0]]]),Overleaf.REPLACABLE_COMMANDS=new Map([["\\&","&"],["\\$","$"],["\\%","%"],["\\_","_"],["\\^","^"],["\\~","~"],["\\#","#"],["\\{","{"],["\\}","}"],["\\S","§"],["\\ "," "],["\\ref","1"],["\\pageref","1"],["\\vref","1"],["\\autoref","(1)"],["\\nameref","(1)"],["\\eqref","(1)"],["\\textbar","|"],["\\textbackslash","\\"],["\\dots","…"],["\\ldots","…"],["\\textbullet","•"],["\\TeX","TeX"],["\\LaTeX","LaTeX"],["\\dotfill"," "],["\\hspace"," "],["\\rule"," "],["\\\\","\n\n"],["\\newline","\n\n"],["\\break","\n\n"],["\\linebreak","\n\n"],["\\pagebreak","\n\n"],["\\cite","[1]"],["\\textasciicircum","^"],["\\textless","<"],["\\textasciitilde","~"],["\\textordfeminine","ª"],["\\textasteriskcentered","∗"],["\\textordmasculine","º"],["\\textparagraph","¶"],["\\textperiodcentered","·"],["\\textbraceleft","{"],["\\textquestiondown","¿"],["\\textbraceright","}"],["\\textquotedblleft","“"],["\\textquotedblright","”"],["\\textcopyright","©"],["\\textquoteleft","‘"],["\\textdagger","†"],["\\textquoteright","’"],["\\textdaggerdbl","‡"],["\\textregistered","®"],["\\textsection","§"],["\\textellipsis","…"],["\\textsterling","£"],["\\textemdash","—"],["\\texttrademark","™"],["\\textendash","–"],["\\textunderscore","_"],["\\textexclamdown","¡"],["\\textvisiblespace","␣"],["\\textgreater",">"],["\\ddag","‡"],["\\P","¶"],["\\copyright","©"],["\\dag","†"],["\\pounds","£"],["\\aa","å"],["\\DH","Ð"],["\\L","Ł"],["\\o","ø"],["\\ss","ß"],["\\AA","Å"],["\\dh","ð"],["\\l","ł"],["\\O","Ø"],["\\SS","SS"],["\\AE","Æ"],["\\DJ","Đ"],["\\NG","Ŋ"],["\\OE","Œ"],["\\TH","Þ"],["\\ae","æ"],["\\dj","đ"],["\\ng","ŋ"],["\\oe","œ"],["\\th","þ"],["\\guillemotleft","«"],["\\guilsinglleft","‹"],["\\quotedblbase","„"],["\\guillemotright","»"],["\\guilsinglright","›"],["\\quotesinglbase","‚"],["\\textasciicaron","ˇ"],["\\textasciimacron","¯"],["\\textasciiacute","´"],["\\textasciidieresis","¨"],["\\textasciibreve","˘"],["\\textasciigrave","`"],["\\textbaht","฿"],["\\textdollar","$"],["\\textguarani","₲"],["\\textwon","₩"],["\\textcent","¢"],["\\textdollaroldstyle","“"],["\\textlira","₤"],["\\textyen","¥"],["\\textcentoldstyle","“"],["\\textdong","₫"],["\\textnaira","₦"],["\\textcolonmonetary","₡"],["\\texteuro","€"],["\\textpeso","₱"],["\\textcurrency","¤"],["\\textflorin","ƒ"],["\\textcircledP","℗"],["\\textservicemark","℠"],["\\textcopyleft","“"],["\\textbardbl","‖"],["\\textbigcircle","◯"],["\\textblank","“"],["\\textbrokenbar","¦"],["\\textpertenthousand","‱"],["\\textperthousand","‰"],["\\textpilcrow","¶"],["\\textquotesingle","'"],["\\textdblhyphen","="],["\\textquotestraightbase","“"],["\\textdblhyphenchar","="],["\\textquotestraightdblbase","“"],["\\textdiscount","⁒"],["\\textrecipe","℞"],["\\textestimated","℮"],["\\textreferencemark","※"],["\\textinterrobang","‽"],["\\textinterrobangdown","“"],["\\textthreequartersemdash","“"],["\\textmusicalnote","♪"],["\\texttildelow","˷"],["\\textnumero","№"],["\\texttwelveudash","“"],["\\textopenbullet","○"],["\\|","“"],["\\G","“"],["\\t","“"],["\\h","“"],["\\U","“"],["\\newtie","“"],["\\mathdollar","$"],["\\mathparagraph","¶"],["\\mathsterling","£"],["\\mathellipsis","…"],["\\mathsection","§"],["\\mathunderscore","_"],["\\amalg","⨿"],["\\cup","∪"],["\\oplus","⊕"],["\\times","×"],["\\ast","∗"],["\\dagger","†"],["\\oslash","⊘"],["\\triangleleft","◁"],["\\bigcirc","◯"],["\\ddagger","‡"],["\\otimes","⊗"],["\\triangleright","▷"],["\\bigtriangledown","▽"],["\\diamond","⋄"],["\\pm","±"],["\\unlhd","⊴"],["\\bigtriangleup","△"],["\\div","÷"],["\\rhd","▷"],["\\unrhd","⊵"],["\\bullet","•"],["\\lhd","◁"],["\\setminus","∖"],["\\uplus","⊎"],["\\cap","∩"],["\\mp","∓"],["\\sqcap","⊓"],["\\vee","∨"],["\\cdot","·"],["\\odot","⊙"],["\\sqcup","⊔"],["\\wedge","∧"],["\\circ","∘"],["\\ominus","⊖"],["\\star","⋆"],["\\wr","≀"],["\\bigcap","∩"],["\\bigotimes","⊗"],["\\bigwedge","∧"],["\\prod","∏"],["\\bigcup","∪"],["\\bigsqcup","⊔"],["\\coprod","∐"],["\\sum","∑"],["\\bigodot","⊙"],["\\biguplus","⊎"],["\\bigoplus","⊕"],["\\bigvee","∨"],["\\approx","≈"],["\\equiv","≡"],["\\perp","⊥"],["\\smile","‿"],["\\asymp","≍"],["\\frown","⁀"],["\\prec","≺"],["\\succ","≻"],["\\bowtie","⋈"],["\\Join","⑅"],["\\preceq","≼"],["\\succeq","≽"],["\\cong","≅"],["\\mid","∣"],["\\propto","∝"],["\\vdash","⊢"],["\\dashv","⊣"],["\\models","⊨"],["\\sim","∼"],["\\doteq","≐"],["\\parallel","∥"],["\\simeq","≃"],["\\sqsubset","⊏"],["\\sqsupseteq","⊒"],["\\supset","⊃"],["\\sqsubseteq","⊑"],["\\subset","⊂"],["\\supseteq","⊇"],["\\sqsupset","⊐"],["\\subseteq","⊆"],["\\geq","≥"],["\\gg","≫"],["\\leq","≤"],["\\ll","≪"],["\\neq","≠"],["\\Downarrow","⇓"],["\\longleftarrow","←—"],["\\nwarrow","↖"],["\\downarrow","↓"],["\\Longleftarrow","⇐="],["\\Rightarrow","⇒"],["\\hookleftarrow","↩"],["\\longleftrightarrow","←→"],["\\rightarrow","→"],["\\hookrightarrow","↪"],["\\Longleftrightarrow","⇐⇒"],["\\searrow","↘"],["\\leadsto","↝"],["\\longmapsto","⊢→"],["\\swarrow","↙"],["\\leftarrow","←"],["\\Longrightarrow","=⇒"],["\\uparrow","↑"],["\\Leftarrow","⇐"],["\\longrightarrow","—→"],["\\Uparrow","⇑"],["\\Leftrightarrow","⇔"],["\\mapsto","↦"],["\\updownarrow","↕"],["\\leftrightarrow","↔"],["\\nearrow","↗"],["\\Updownarrow","⇕"],["\\leftharpoondown","↽"],["\\rightharpoondown","⇁"],["\\rightleftharpoons","⇌"],["\\leftharpoonup","↼"],["\\rightharpoonup","⇀"],["\\relbar","⎯"],["\\Relbar","="],["\\textdownarrow","↓"],["\\textrightarrow","→"],["\\textleftarrow","←"],["\\textuparrow","↑"],["\\ddot","“"],["\\vec","“"],["\\alpha","α"],["\\theta","θ"],["\\tau","τ"],["\\beta","β"],["\\vartheta","ϑ"],["\\pi","π"],["\\upsilon","υ"],["\\gamma","γ"],["\\iota","ι"],["\\varpi","ϖ"],["\\phi","φ"],["\\delta","δ"],["\\kappa","κ"],["\\rho","ρ"],["\\varphi","ϕ"],["\\epsilon","є"],["\\lambda","λ"],["\\varrho","ϱ"],["\\chi","χ"],["\\varepsilon","ε"],["\\mu","µ"],["\\sigma","σ"],["\\psi","ψ"],["\\zeta","ζ"],["\\nu","ν"],["\\varsigma","ς"],["\\omega","ω"],["\\eta","η"],["\\xi","ξ"],["\\Gamma","Γ"],["\\Lambda","Λ"],["\\Sigma","Σ"],["\\Psi","Ψ"],["\\Delta","Δ"],["\\Xi","Ξ"],["\\Upsilon","Υ"],["\\Omega","Ω"],["\\Theta","Θ"],["\\Pi","Π"],["\\Phi","Φ"],["\\bot","⊥"],["\\forall","∀"],["\\ni","∋"],["\\top","⊤"],["\\ell","ℓ"],["\\hbar","ℏ"],["\\in","∈"],["\\partial","∂"],["\\wp","℘"],["\\exists","∃"],["\\Im","ℑ"],["\\Re","ℜ"],["\\textlangle","〈"],["\\textrangle","〉"],["\\textlbrackdbl","⟦"],["\\textrbrackdbl","⟧"],["\\textlquill","“"],["\\textrquill","“"],["\\widetilde","“"],["\\widehat","“"],["\\cdotp","·"],["\\colon","∶"],["\\ldotp","."],["\\vdots","⋮"],["\\cdots","⋯"],["\\ddots","⋱"],["\\textdegree","°"],["\\textonehalf","½"],["\\textthreequarters","¾"],["\\textdiv","÷"],["\\textonequarter","¼"],["\\textthreesuperior","³"],["\\textfractionsolidus","⁄"],["\\textonesuperior","¹"],["\\texttimes","×"],["\\textlnot","¬"],["\\textpm","±"],["\\texttwosuperior","²"],["\\textminus","-"],["\\textsurd","√"],["\\textcelsius","℃"],["\\textmho","℧"],["\\textmu","µ"],["\\textohm","Ω"],["\\textborn","⋆"],["\\textdivorced","⚮"],["\\textmarried","⚭"],["\\textdied","⚰"],["\\textleaf","“"],["\\aleph","ℵ"],["\\Diamond","◇"],["\\infty","∞"],["\\prime","′"],["\\angle","∠"],["\\diamondsuit","♦"],["\\mho","℧"],["\\sharp","♯"],["\\backslash","\\"],["\\emptyset","∅"],["\\nabla","∇"],["\\spadesuit","♠"],["\\Box","□"],["\\flat","♭"],["\\natural","♮"],["\\surd","√"],["\\clubsuit","♣"],["\\heartsuit","♥"],["\\neg","¬"],["\\triangle","△"],["\\checkmark","✓"],["\\circledR","®"],["\\maltese","✠"],["\\barwedge","⊼"],["\\circledcirc","⊚"],["\\intercal","⊺"],["\\boxdot","⊡"],["\\circleddash","⊝"],["\\leftthreetimes","⋋"],["\\boxminus","⊟"],["\\Cup","⋓"],["\\ltimes","⋉"],["\\boxplus","⊞"],["\\curlyvee","⋎"],["\\rightthreetimes","⋌"],["\\boxtimes","⊠"],["\\curlywedge","⋏"],["\\rtimes","⋊"],["\\Cap","⋒"],["\\divideontimes","⋇"],["\\smallsetminus","﹨"],["\\centerdot","·"],["\\dotplus","∔"],["\\veebar","⊻"],["\\circledast","⊛"],["\\doublebarwedge","⌆"],["\\approxeq","≊"],["\\eqcirc","≖"],["\\succapprox","≿"],["\\backepsilon","∍"],["\\fallingdotseq","≒"],["\\succcurlyeq","≽"],["\\backsim","∽"],["\\multimap","⊸"],["\\succsim","≿"],["\\backsimeq","⋍"],["\\pitchfork","⋔"],["\\therefore","∴"],["\\because","∵"],["\\precapprox","≾"],["\\thickapprox","“"],["\\between","≬"],["\\preccurlyeq","≼"],["\\thicksim","“"],["\\Bumpeq","≎"],["\\precsim","≾"],["\\varpropto","∝"],["\\bumpeq","≏"],["\\risingdotseq","≓"],["\\Vdash","⊩"],["\\circeq","≗"],["\\shortmid","“"],["\\vDash","⊨"],["\\curlyeqprec","⋞"],["\\shortparallel","“"],["\\Vvdash","⊪"],["\\curlyeqsucc","⋟"],["\\smallfrown","“"],["\\doteqdot","≑"],["\\smallsmile","“"],["\\ncong","≇"],["\\nshortparallel","“"],["\\nVDash","⊯"],["\\nmid","∤"],["\\nsim","≁"],["\\precnapprox","⋨"],["\\nparallel","∦"],["\\nsucc","⊁"],["\\precnsim","⋨"],["\\nprec","⊀"],["\\nsucceq","⋡"],["\\succnapprox","⋩"],["\\npreceq","⋠"],["\\nvDash","⊭"],["\\succnsim","⋩"],["\\nshortmid","“"],["\\nvdash","⊬"],["\\nsubseteq","⊈"],["\\subseteqq","⫅"],["\\supsetneqq","⫌"],["\\nsupseteq","⊉"],["\\subsetneq","⊊"],["\\varsubsetneq","“"],["\\nsupseteqq","“"],["\\subsetneqq","⫋"],["\\varsubsetneqq","“"],["\\Supset","⋑"],["\\varsupsetneq","“"],["\\supseteqq","⫆"],["\\varsupsetneqq","“"],["\\Subset","⋐"],["\\supsetneq","⊋"],["\\eqslantgtr","⋝"],["\\gtrdot","⋗"],["\\lesseqgtr","⋚"],["\\ngeq","≱"],["\\eqslantless","⋜"],["\\gtreqless","⋛"],["\\lesseqqgtr","⪋"],["\\ngeqq","“"],["\\geqq","≧"],["\\gtreqqless","⪌"],["\\lessgtr","≶"],["\\ngeqslant","“"],["\\geqslant","⩾"],["\\gtrless","≷"],["\\lesssim","≲"],["\\ngtr","≯"],["\\ggg","⋙"],["\\gtrsim","≳"],["\\lll","⋘"],["\\nleq","≰"],["\\gnapprox","⪊"],["\\gvertneqq","“"],["\\lnapprox","⪇"],["\\nleqq","“"],["\\gneq","⪈"],["\\leqq","≦"],["\\lneq","⪇"],["\\nleqslant","“"],["\\gneqq","≩"],["\\leqslant","⩽"],["\\lneqq","≨"],["\\nless","≮"],["\\gnsim","⋧"],["\\lessapprox","≲"],["\\lnsim","⋦"],["\\gtrapprox","≳"],["\\lessdot","⋖"],["\\lvertneqq","“"],["\\blacktriangleleft","◂"],["\\ntrianglelefteq","⋬"],["\\trianglelefteq","⊴"],["\\vartriangleleft","⊲"],["\\blacktriangleright","▸"],["\\ntriangleright","⋫"],["\\triangleq","≜"],["\\vartriangleright","⊳"],["\\ntriangleleft","⋪"],["\\ntrianglerighteq","⋭"],["\\trianglerighteq","⊵"],["\\circlearrowleft","↺"],["\\leftleftarrows","⇇"],["\\rightleftarrows","⇄"],["\\circlearrowright","↻"],["\\leftrightarrows","⇆"],["\\rightrightarrows","⇉"],["\\curvearrowleft","↶"],["\\leftrightsquigarrow","↭"],["\\rightsquigarrow","⇝"],["\\curvearrowright","↷"],["\\Lleftarrow","⇚"],["\\Rsh","↱"],["\\dashleftarrow","⇠"],["\\looparrowleft","↫"],["\\twoheadleftarrow","↞"],["\\dashrightarrow","⇢"],["\\looparrowright","↬"],["\\twoheadrightarrow","↠"],["\\downdownarrows","⇊"],["\\Lsh","↰"],["\\upuparrows","⇈"],["\\leftarrowtail","↢"],["\\rightarrowtail","↣"],["\\nLeftarrow","⇍"],["\\nLeftrightarrow","⇎"],["\\nRightarrow","⇏"],["\\nleftarrow","↚"],["\\nleftrightarrow","↮"],["\\nrightarrow","↛"],["\\downharpoonleft","⇃"],["\\leftrightharpoons","⇋"],["\\upharpoonleft","↿"],["\\downharpoonright","⇂"],["\\upharpoonright","↾"],["\\injlim","inj lim"],["\\varinjlim","“"],["\\projlim","proj lim"],["\\varprojlim","“"],["\\digamma","Ϝ"],["\\varkappa","ϰ"],["\\beth","ℶ"],["\\gimel","ℷ"],["\\daleth","ℸ"],["\\Bbbk","ƙ"],["\\complement","∁"],["\\Finv","Ⅎ"],["\\hslash","ℏ"],["\\circledS","Ⓢ"],["\\Game","อ"],["\\nexists","∄"],["\\ulcorner","⌜"],["\\urcorner","⌝"],["\\llcorner","⌞"],["\\lrcorner","⌟"],["\\dddot","“"],["\\dotsb","⋯"],["\\dotsi","⋯"],["\\dotso","…"],["\\dotsc","…"],["\\dotsm","⋯"],["\\blacktriangledown","▾"],["\\backprime","‵"],["\\diagdown","/"],["\\sphericalangle","∢"],["\\bigstar","★"],["\\square","▫"],["\\blacklozenge","✦"],["\\eth","ð"],["\\triangledown","▿"],["\\blacksquare","▪"],["\\lozenge","◊"],["\\varnothing","∅"],["\\blacktriangle","▴"],["\\measuredangle","∡"],["\\vartriangle","▵"],["\\chapter",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:" ".repeat(r-t.start-1)+e.substring(r,i)+"\n\n",offsetShift:1}}],["\\chapter*",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:" ".repeat(r-t.start-1)+e.substring(r,i)+"\n\n",offsetShift:1}}],["\\section",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:" ".repeat(r-t.start-1)+e.substring(r,i)+"\n\n",offsetShift:1}}],["\\section*",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:" ".repeat(r-t.start-1)+e.substring(r,i)+"\n\n",offsetShift:1}}],["\\subsection",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:" ".repeat(r-t.start-1)+e.substring(r,i)+"\n\n",offsetShift:1}}],["\\subsection*",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:" ".repeat(r-t.start-1)+e.substring(r,i)+"\n\n",offsetShift:1}}],["\\subsubsection",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:" ".repeat(r-t.start-1)+e.substring(r,i)+"\n\n",offsetShift:1}}],["\\subsubsection*",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:" ".repeat(r-t.start-1)+e.substring(r,i)+"\n\n",offsetShift:1}}],["\\paragraph",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:" ".repeat(r-t.start-1)+e.substring(r,i)+"\n\n",offsetShift:1}}],["\\footnote",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:" ".repeat(r-t.start-1)+"("+e.substring(r,i)+")",offsetShift:0}}],["\\footnotetext",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:" ".repeat(r-t.start-1)+"("+e.substring(r,i)+")",offsetShift:0}}],["\\rhead",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:" ".repeat(r-t.start-1)+e.substring(r,i)+"\n\n",offsetShift:1}}],["\\lhead",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:" ".repeat(r-t.start-1)+e.substring(r,i)+"\n\n",offsetShift:1}}],["\\rfoot",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:" ".repeat(r-t.start-1)+e.substring(r,i)+"\n\n",offsetShift:1}}]]),Overleaf.DISABLED_RULES=["UNPAIRED_BRACKETS"],Overleaf._interval=null,Overleaf._onInputAreaAvailableCallbacks=[];class OverleafSourceEditor{static _constructor(){this._onEditorMouseDown=this._onEditorMouseDown.bind(this),this._onEditorContextMenu=this._onEditorContextMenu.bind(this),this._domMeasurement=new DomMeasurement,this._mutationObserversHub=new MutationObserversHub(this.THROTTLED_MUTATION_OBSERVER_DELAY)}static _isMouseOnError(t){return Array.from(document.querySelectorAll(this.HIGHLIGHTED_ERRORS_SELECTOR)).some(e=>isPointInsideRect(e.getBoundingClientRect(),t.pageX,t.pageY))}static _onEditorMouseDown(t){2===t.button&&this._isMouseOnError(t)&&t.stopPropagation()}static _onEditorContextMenu(t){this._isMouseOnError(t)&&t.stopPropagation()}static getInputAreas(){return Array.from(document.querySelectorAll(this.EDITOR_SELECTOR))}static isEditor(t){return t.matches(this.EDITOR_SELECTOR)}static disableBuiltInValidator(){if(null===this._styleTag){this._styleTag=createStylesheet(`${this.HIGHLIGHTED_ERRORS_SELECTOR} {\n\t\t\t\t\tbackground-image: none !important;\n\t\t\t\t}`);const t=document.querySelector(this.EDITOR_SELECTOR);t&&(t.addEventListener("mousedown",this._onEditorMouseDown,!0),t.addEventListener("contextmenu",this._onEditorContextMenu,!0))}}static enableBuiltInValidator(){null!==this._styleTag&&(this._styleTag.remove(),this._styleTag=null);const t=document.querySelector(this.EDITOR_SELECTOR);t&&(t.removeEventListener("mousedown",this._onEditorMouseDown,!0),t.removeEventListener("contextmenu",this._onEditorContextMenu,!0))}static createMutationObserver(t){return this._mutationObserversHub.createMutationObserver(t)}static isElementIgnored(t){return!contains(t,this.TEXT_LAYER_SELECTOR)&&!closestElement(t,this.TEXT_LAYER_SELECTOR)}static isBlock(t,e){return!t.classList.contains("ace_line")&&CEElementInspector.DISPLAY_BLOCK_VALUES.includes(e.display||"")}static isBlockElementRelevant(t){return t.classList.contains("ace_line_group")&&1===t.childNodes.length&&1===t.children.length&&t.firstElementChild.classList.contains("ace_line")&&0===t.firstElementChild.childNodes.length}static isMutationIgnored(t){const e=t.target;return!!isElementNode(e)&&(!!this.isElementIgnored(e)||!(!e.matches("div.ace_editor.ace-editor-body")||"attributes"!==t.type||"class"!==t.attributeName))}static getFullTextInfo(t,e){if(!e)return{text:e,offset:0};if(!t.ownerDocument||!t.ownerDocument.head)return{text:e,offset:0};const r=t.ownerDocument,i=r.createElement("script"),n="LanguageTool_SourceEditorContent";i.innerText=`\n\t\t\t\ttry {\n\t\t\t\t\tdocument.body.dataset.${n} = _ide.editorManager.getCurrentDocValue() || "";\n\t\t\t\t} catch(e) { }\n\t\t\t`,r.head.appendChild(i),i.remove();const o=r.body.dataset[n]||"";if(r.body.dataset[n]="",!o)return{text:e,offset:0};const s=Array.from(document.querySelectorAll(this.LINE_NUMBER_SELECTOR));if(0===s.length||!s[0].textContent)return{text:e,offset:0};const a=parseInt(s[0].textContent.trim()),l=a+document.querySelectorAll(this.TEXT_LINE_SELECTOR).length-1,c=o.split("\n");let d=c.slice(0,a-1).join("\n\n");d&&(d+="\n\n");let u=c.slice(l).join("\n\n");return u&&(u="\n\n"+u),{text:d+e+u,offset:d.length}}static getSelectedText(){if(!document.activeElement||"TEXTAREA"!==document.activeElement.tagName.toUpperCase())return"";const t=this.getSelection();if(!t)return"";const e=new Range;return e.setStart(t.startNode,t.startOffset),e.setEnd(t.endNode,t.endOffset),e.toString()}static getSelection(){const t=Array.from(document.body.querySelectorAll(this.SELECTION_BLOCK_SELECTOR));if(!t.length)return null;const e=document.querySelector(this.TEXT_LAYER_SELECTOR);if(!e)return null;const r=t[0].getBoundingClientRect(),i=1===t.length?r:t[t.length-1].getBoundingClientRect();this._domMeasurement.setStyles(e,{"pointer-events":"auto"},!0);const n=getRangeAtPoint({x:r.left+1,y:Math.round(r.bottom-.5*r.height)}),o=getRangeAtPoint({x:i.right-.5,y:Math.round(i.bottom-.5*i.height)});return this._domMeasurement.removeStyle(e,"pointer-events"),n&&o?{startNode:n.startContainer,startOffset:n.startOffset,endNode:o.endContainer,endOffset:o.endOffset,isCollapsed:!1}:null}static addScrollEventListener(t,e){t.addEventListener("scroll",e);const r=t.querySelector(this.VERTICAL_SCROLL_SELECTOR);r&&r.addEventListener("scroll",e)}static removeScrollEventListener(t,e){t.removeEventListener("scroll",e);const r=t.querySelector(this.VERTICAL_SCROLL_SELECTOR);r&&r.removeEventListener("scroll",e)}static getScrollableElementSize(t,e){const r=t.querySelector(this.VERTICAL_SCROLL_SELECTOR);if(!r||"none"===e.getStyle(r,"display"))return e.getScrollDimensions(t,!1);const{height:i}=e.getScrollDimensions(r,!1),{width:n}=e.getScrollDimensions(t,!1);return{height:i,width:n}}static getScrollPosition(t,e,r,i){const n=t.querySelector(this.VERTICAL_SCROLL_SELECTOR);if(!n)return e.getScrollPosition(t,r,i);const{top:o}=e.getScrollPosition(n,r,i),{left:s}=e.getScrollPosition(t,r,i);return{top:o,left:s}}static getScrollingThrottleLimit(){return 100}static getToolbarPosition(t,e,r){if(!r||void 0===r.left)return r;const i=t.querySelector(this.VERTICAL_SCROLL_SELECTOR);if(!i)return r;if("none"!==this._domMeasurement.getStyle(i,"display")){const t=Number.parseInt(r.left),n=Number.parseInt(this._domMeasurement.getStyle(i,"width"));r.left=(e?t+n:t-n)+"px"}return r}static shouldUsePartialValidationCaching(t){return""!==t.validatedText.text}static getValidationOptions(t,e){return{useFullValidation:!1,textTooLongMessage:i18nManager.getMessage("paragraphTooLong")}}static applyFix(t){const{offset:e,length:r,replacementText:i,editor:n}=t,o=n.inputArea.querySelector(this.EVENT_TARGET_SELECTOR);if(!o)return Promise.resolve();const s=n.inputArea.querySelector(this.PASTE_TEXTAREA_SELECTOR);if(!s)return Promise.resolve();const a=n.inputAreaWrapper.getTextRanges(e,r);return Promise.resolve().then(()=>{this._domMeasurement.clearCache();const t=this._domMeasurement.getTextBoundingBoxes(a,n.inputArea,!1)[0],e={clientX:Math.ceil(t.left),clientY:t.top+t.height/2,bubbles:!0,shiftKey:!1};return o.dispatchEvent(new MouseEvent("mousedown",e)),o.dispatchEvent(new MouseEvent("mouseup",e)),wait(10)}).then(()=>{this._domMeasurement.clearCache();const t=this._domMeasurement.getTextBoundingBoxes(a,n.inputArea,!1),e=t[0],r=t[t.length-1],i={clientX:Math.ceil(e.left),clientY:e.top+e.height/2,bubbles:!0,shiftKey:!1},s={clientX:Math.floor(r.right),clientY:r.top+r.height/2,bubbles:!0,shiftKey:!1};return o.dispatchEvent(new MouseEvent("mousedown",i)),o.dispatchEvent(new MouseEvent("mousemove",s)),o.dispatchEvent(new MouseEvent("mouseup",s)),wait(10)}).then(()=>{const t=new ClipboardEvent("paste",{clipboardData:new DataTransfer,bubbles:!0});BrowserDetector.isFirefox()?t.wrappedJSObject.clipboardData.setData("text/plain",i):t.clipboardData.setData("text/plain",i),s.dispatchEvent(t)})}}OverleafSourceEditor.EDITOR_SELECTOR="div#editor",OverleafSourceEditor.HIGHLIGHTED_ERRORS_SELECTOR="div#editor div.spelling-highlight",OverleafSourceEditor.SELECTION_BLOCK_SELECTOR="div.ace_selection",OverleafSourceEditor.TEXT_LAYER_SELECTOR="div.ace_layer.ace_text-layer",OverleafSourceEditor.LINE_NUMBER_SELECTOR="div.ace_editor.ace-editor-body > div.ace_gutter > div.ace_gutter-layer > div.ace_gutter-cell",OverleafSourceEditor.TEXT_LINE_SELECTOR="div.ace_editor.ace-editor-body div.ace_content > div.ace_text-layer > div.ace_line_group",OverleafSourceEditor.VERTICAL_SCROLL_SELECTOR="div.ace_scrollbar.ace_scrollbar-v",OverleafSourceEditor.EVENT_TARGET_SELECTOR="div.ace_content",OverleafSourceEditor.PASTE_TEXTAREA_SELECTOR="textarea.ace_text-input",OverleafSourceEditor.THROTTLED_MUTATION_OBSERVER_DELAY=500,OverleafSourceEditor._styleTag=null;class OverleafRichTextEditor{static _constructor(){this._onEditorMouseDown=this._onEditorMouseDown.bind(this),this._onEditorContextMenu=this._onEditorContextMenu.bind(this),this._domMeasurement=new DomMeasurement}static _isMouseOnError(t){return Array.from(document.querySelectorAll(this.HIGHLIGHTED_ERRORS_SELECTOR)).some(e=>isPointInsideRect(e.getBoundingClientRect(),t.pageX,t.pageY))}static _onEditorMouseDown(t){2===t.button&&this._isMouseOnError(t)&&t.stopPropagation()}static _onEditorContextMenu(t){this._isMouseOnError(t)&&t.stopPropagation()}static _isTextLayer(t){return contains(t,this.TEXT_LAYER_SELECTOR)||!!closestElement(t,this.TEXT_LAYER_SELECTOR)}static _isLineNumber(t){return t.matches(this.LINE_NUMBER_SELECTOR)}static _isWidget(t){return t.matches(this.WIDGET_SELECTOR)||!!closestElement(t,this.WIDGET_SELECTOR)}static _isLabelWidget(t){if(t.matches(this.LABEL_WIDGET_OPEN_BRACKET_SELECTOR)&&"{"===t.textContent)return!0;const e=t.querySelector(this.LABEL_WIDGET_OPEN_BRACKET_SELECTOR);if(e&&"{"===e.textContent)return!0;if(t.matches(this.LABEL_WIDGET_CLOSE_BRACKET_SELECTOR)&&"}"===t.textContent)return!0;const r=t.querySelector(this.LABEL_WIDGET_CLOSE_BRACKET_SELECTOR);return!(!r||"{"!==r.textContent)}static _isReferenceWidget(t){if(t.matches(this.REFERENCE_WIDGET_OPEN_BRACKET_SELECTOR)&&"{"===t.textContent)return!0;const e=t.querySelector(this.REFERENCE_WIDGET_OPEN_BRACKET_SELECTOR);if(e&&"{"===e.textContent)return!0;if(t.matches(this.REFERENCE_WIDGET_CLOSE_BRACKET_SELECTOR)&&"}"===t.textContent)return!0;const r=t.querySelector(this.REFERENCE_WIDGET_CLOSE_BRACKET_SELECTOR);return!(!r||"}"!==r.textContent)}static _isMathWidget(t){return contains(t,this.MATH_WIDGET_SELECTOR)||t.matches(this.MATH_WIDGET_SELECTOR)||!!closestElement(t,this.MATH_WIDGET_SELECTOR)}static _isUsefulWidget(t){return this._isLabelWidget(t)||this._isReferenceWidget(t)||this._isMathWidget(t)}static _isLabelOpenBracket(t){return!!t.parentElement&&(t.parentElement.matches(this.LABEL_WIDGET_OPEN_BRACKET_SELECTOR)&&"{"===t.textContent)}static _isReferenceOpenBracket(t){return!!t.parentElement&&(t.parentElement.matches(this.REFERENCE_WIDGET_OPEN_BRACKET_SELECTOR)&&"{"===t.textContent)}static getInputAreas(){return Array.from(document.querySelectorAll(this.EDITOR_SELECTOR))}static disableBuiltInValidator(){if(null===this._styleTag){this._styleTag=createStylesheet(`${this.HIGHLIGHTED_ERRORS_SELECTOR} {\n\t\t\t\t\tbackground-image: none !important;\n\t\t\t\t}`);const t=document.querySelector(this.EDITOR_SELECTOR);t&&(t.addEventListener("mousedown",this._onEditorMouseDown,!0),t.addEventListener("contextmenu",this._onEditorContextMenu,!0))}}static enableBuiltInValidator(){null!==this._styleTag&&(this._styleTag.remove(),this._styleTag=null);const t=document.querySelector(this.EDITOR_SELECTOR);t&&(t.addEventListener("mousedown",this._onEditorMouseDown,!0),t.addEventListener("contextmenu",this._onEditorContextMenu,!0))}static createMutationObserver(t){return new MutationObserver(t)}static isEditor(t){return t.matches(this.EDITOR_SELECTOR)}static isElementIgnored(t){return!this._isTextLayer(t)||this._isLineNumber(t)||this._isWidget(t)&&!this._isUsefulWidget(t)}static isBlock(t,e){return CEElementInspector.DISPLAY_BLOCK_VALUES.includes(e.display||"")}static isBlockElementRelevant(t){return t.classList.contains("CodeMirror-line")&&1===t.children.length&&1===t.firstElementChild.children.length&&"​"===t.firstElementChild.firstElementChild.textContent}static isMutationIgnored(t){const e=t.target;return!!isElementNode(e)&&(!(this._isTextLayer(e)&&!this._isLineNumber(e))||!(!e.matches(this.EDITOR_WRAPPER_SELECTOR)||"attributes"!==t.type||"class"!==t.attributeName))}static replaceText(t,e){if(this._isLabelOpenBracket(e))return"\\label{";if(this._isReferenceOpenBracket(e))return"\\cite{";t=removeZWC(t),t=normalizeWhiteSpaces(t);const r=e.parentElement;return r&&r.matches(this.SECTION_TITLE_SELECTOR)&&(t+="\n\n\n\n"),t}static getFullTextInfo(t,e){if(!e)return{text:e,offset:0};if(!t.ownerDocument||!t.ownerDocument.head)return{text:e,offset:0};const r=t.ownerDocument,i=r.createElement("script"),n="LanguageTool_SourceEditorContent";i.innerText=`\n\t\t\t\ttry {\n\t\t\t\t\tdocument.body.dataset.${n} = _ide.editorManager.getCurrentDocValue() || "";\n\t\t\t\t} catch(e) { }\n\t\t\t`,r.head.appendChild(i),i.remove();const o=r.body.dataset[n]||"";if(r.body.dataset[n]="",!o)return{text:e,offset:0};const s=Array.from(document.querySelectorAll(this.LINE_NUMBER_SELECTOR));if(0===s.length||!s[0].textContent)return{text:e,offset:0};const a=parseInt(s[0].textContent.trim()),l=a+document.querySelectorAll(this.TEXT_LINE_SELECTOR).length-1,c=o.split("\n");let d=c.slice(0,a-1).join("\n\n");d&&(d+="\n\n");let u=c.slice(l).join("\n\n");return u&&(u="\n\n"+u),{text:d+e+u,offset:d.length}}static getSelectedText(){if(!document.activeElement||"TEXTAREA"!==document.activeElement.tagName.toUpperCase())return"";const t=this.getSelection();if(!t)return"";const e=new Range;return e.setStart(t.startNode,t.startOffset),e.setEnd(t.endNode,t.endOffset),e.toString()}static getSelection(){const t=Array.from(document.body.querySelectorAll(this.SELECTION_BLOCK_SELECTOR));if(!t.length)return null;let e=t[0].getBoundingClientRect(),r=t[0].getBoundingClientRect();for(const i of t){const t=i.getBoundingClientRect();(t.top<e.top||t.top===e.top&&t.left<e.left)&&(e=t),(t.top>r.top||t.top===r.top&&t.left>r.left)&&(r=t)}const i=getRangeAtPoint({x:e.left+1,y:Math.round(e.bottom-.5*e.height)}),n=getRangeAtPoint({x:r.right-.5,y:Math.round(r.bottom-.5*r.height)});return i&&n?{startNode:i.startContainer,startOffset:i.startOffset,endNode:n.endContainer,endOffset:n.endOffset,isCollapsed:!1}:null}static addScrollEventListener(t,e){(t.querySelector(this.SCROLLABLE_ELEMENT_SELECTOR)||t).addEventListener("scroll",e)}static removeScrollEventListener(t,e){(t.querySelector(this.SCROLLABLE_ELEMENT_SELECTOR)||t).removeEventListener("scroll",e)}static getScrollableElementSize(t,e){const r=t.querySelector(this.SCROLLABLE_ELEMENT_SELECTOR)||t;return e.getScrollDimensions(r,!1)}static getScrollPosition(t,e,r,i){const n=t.querySelector(this.SCROLLABLE_ELEMENT_SELECTOR),o=t.querySelector(this.EDITOR_WRAPPER_SELECTOR);if(!n||!o)return e.getScrollPosition(t,r,i);let{top:s,left:a}=e.getScrollPosition(n,r,i);return{top:s+=e.getScrollPosition(o,r,i).top,left:a}}static getScrollingThrottleLimit(){}static getToolbarPosition(t,e,r){if(!r||void 0===r.left)return r;const i=t.querySelector(this.VERTICAL_SCROLLBAR_SELECTOR);if(!i)return r;if("none"!==this._domMeasurement.getStyle(i,"display")){const t=Number.parseInt(r.left),n=Number.parseInt(this._domMeasurement.getStyle(i,"width"));r.left=(e?t+n:t-n)+"px"}return r}static shouldUsePartialValidationCaching(t){return""!==t.validatedText.text}static getValidationOptions(t,e){return{useFullValidation:!1,textTooLongMessage:i18nManager.getMessage("paragraphTooLong")}}static applyFix(t){const{offset:e,length:r,replacementText:i,editor:n}=t,o=closestElement(n.inputArea,this.EDITOR_SELECTOR);if(!o)return Promise.resolve();const s=o.querySelector(this.PASTE_TEXTAREA_SELECTOR);if(!s)return Promise.resolve();const a=n.inputAreaWrapper.getTextRanges(e,r),l=a[0].textNode.parentElement.closest("pre.CodeMirror-line");return l?Promise.resolve().then(()=>{this._domMeasurement.clearCache();const t=this._domMeasurement.getTextBoundingBoxes(a,n.inputArea,!1)[0],e={clientX:Math.ceil(t.left),clientY:t.top+t.height/2,bubbles:!0,shiftKey:!1};return l.dispatchEvent(new MouseEvent("mousedown",e)),l.dispatchEvent(new MouseEvent("mouseup",e)),wait(10)}).then(()=>{this._domMeasurement.clearCache();const t=this._domMeasurement.getTextBoundingBoxes(a,n.inputArea,!1),e=t[0],r=t[t.length-1],i={clientX:Math.ceil(e.left),clientY:e.top+e.height/2,bubbles:!0,shiftKey:!1},o={clientX:Math.floor(r.right),clientY:r.top+r.height/2,bubbles:!0,shiftKey:!1};return l.dispatchEvent(new MouseEvent("mousedown",i)),l.dispatchEvent(new MouseEvent("mousemove",o)),l.dispatchEvent(new MouseEvent("mouseup",o)),wait(10)}).then(()=>{const t=new ClipboardEvent("paste",{clipboardData:new DataTransfer,bubbles:!0});BrowserDetector.isFirefox()?t.wrappedJSObject.clipboardData.setData("text/plain",i):t.clipboardData.setData("text/plain",i),s.dispatchEvent(t)}):Promise.resolve()}}OverleafRichTextEditor.EDITOR_SELECTOR="div#editor-rich-text",OverleafRichTextEditor.HIGHLIGHTED_ERRORS_SELECTOR="div#editor-rich-text span.spelling-error",OverleafRichTextEditor.EDITOR_WRAPPER_SELECTOR="div.CodeMirror.CodeMirror-wrap",OverleafRichTextEditor.SELECTION_BLOCK_SELECTOR="div.CodeMirror-selected",OverleafRichTextEditor.TEXT_LAYER_SELECTOR="div.CodeMirror-code",OverleafRichTextEditor.LINE_NUMBER_SELECTOR="div.CodeMirror-gutter-wrapper > div.CodeMirror-linenumber",OverleafRichTextEditor.TEXT_LINE_SELECTOR="div.CodeMirror-lines div.CodeMirror-code pre.CodeMirror-line",OverleafRichTextEditor.WIDGET_SELECTOR="span.CodeMirror-widget",OverleafRichTextEditor.LABEL_WIDGET_OPEN_BRACKET_SELECTOR="span.CodeMirror-widget > span.wl-label-open > span.fa.fa-fw.fa-tag + span.wl-label-bracket",OverleafRichTextEditor.LABEL_WIDGET_CLOSE_BRACKET_SELECTOR="span.CodeMirror-widget > span.wl-label-bracket",OverleafRichTextEditor.REFERENCE_WIDGET_OPEN_BRACKET_SELECTOR="span.CodeMirror-widget > span.wl-label-open > span.fa.fa-fw.fa-book + span.wl-label-bracket",OverleafRichTextEditor.REFERENCE_WIDGET_CLOSE_BRACKET_SELECTOR="span.CodeMirror-widget > span.wl-label-bracket",OverleafRichTextEditor.MATH_WIDGET_SELECTOR="script[type*='math/tex']",OverleafRichTextEditor.SECTION_TITLE_SELECTOR="span.wl-section, span.wl-subsection, span.wl-subsubsection",OverleafRichTextEditor.SCROLLABLE_ELEMENT_SELECTOR="div.CodeMirror-scroll",OverleafRichTextEditor.VERTICAL_SCROLLBAR_SELECTOR="div.CodeMirror-vscrollbar",OverleafRichTextEditor.PASTE_TEXTAREA_SELECTOR="div > textarea[tabindex='0']",OverleafRichTextEditor._styleTag=null,OverleafSourceEditor._constructor(),OverleafRichTextEditor._constructor(),"undefined"!=typeof module&&(module.exports.Overleaf=Overleaf);